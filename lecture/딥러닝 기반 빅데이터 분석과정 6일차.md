# 딥러닝 기반 빅데이터 분석과정 6일차

## 1. sqldf 사용해보기

- ```R
  # sqldf 사용해보기
  install.packages("sqldf")
  library(sqldf)
  ?Orange
  
  sqldf('SELECT * FROM Orange')
  class(df)
  ```

- 



## 2. MySQL 설치

### (1) MySQL 파일 설치

#### 1) 기본 설치

- 이동 : https://dev.mysql.com/downloads/mysql/ 

  - 5.6.41버전 설치

  - ![6-1](./image/6-1.PNG)

    ![6-2](./image/6-2.PNG)

- 설치시 framework 설치하라는 경고메시지 뜬다면 해당 프레임워크 설치
  - ![6-3](./image/6-3.PNG)
  - NET Framework 4.5.2 별도 설치
- mysql 설치
  - setup type은 디폴트인 developer default 설치하거나 custom
  - custom 시 아래 사진과 같이 설치
    - ![6-4](./image/6-4.PNG)
    - ![6-5](./image/6-5.PNG)
  - 만약에 설치가 안되면 visual studio c++ 2015 설치
  - 이후 비밀번호 설정만 간단히 하고 다 기본설정
  - ![6-6](./image/6-6.PNG)
  - cmd 창에서 ipconfig로 IPv4 주소 확인하면 그 주소로 지금 접속하는 것임 (즉, 내 컴퓨터를 서버로해서 접속) -> 70.12.115.68



#### 2) 설치 후 설정 및 간단 사용

- 새로운 계정을 생성한다.
  - ![6-7](./image/6-7.PNG)
  - ![6-8](./image/6-8.PNG)
  - newuser가 새로 생성된 것을 확인한 후 재실행한다.
- 새로 만든 계정으로 다른 주소 컴퓨터에 접속해보자 (나는 client, 다른 컴퓨터는 server)
  - ![6-9](./image/6-9.PNG)
  - 다른 컴퓨터가 서버로 작동하고 있는 IP 주소를 넣는다. (나는 68, 다른 컴퓨터는 72)
  - 새로 만들었던 user1 아이디와 비밀번호를 입력한다.
  - Test connection이 잘 작동된 것을 확인한 후, Connection Name(닉네임)을 설정하고 연결한다.

- local instance는 나의 컴퓨터 서버, 새로 생긴 connection은 다른 컴퓨터 서버
  - ![6-10](./image/6-10.PNG)



#### 3) 환경 변수 설정

- 환경 변수는 cmd에서 mysql.exe 를 디렉토리 찾아서 사용하는 것이 아닌 어디서든 사용할 수 있게 하는 것
  - MYSQL_HOME 환경변수 추가 : C:\Program Files\MySQL\MySQL Server 5.6(5.6버전인 경우)
    - ![6-11](./image/6-11.PNG)
  - PATH 경로에는 ;%MYSQL_HOME%\bin 추가
    - ![6-12](./image/6-12.PNG)



- ![6-13](./image/6-13.PNG)
  - 만약에 계정관련 오류가 뜬다면 계정접속을 한다.
    - mysql -u root -p
    - 내가 만든 계정 비밀번호(1234)



#### 4) 샘플 데이터 베이스 설치

- 강사님이 주신 파일 압출 풀기(test_db-master.zip)

- cmd 위치 바로가는 좋은 팁. 해당 폴더 빈 공간에 shift + 오른쪽 클릭하면 '여기서 명령창 열기' 실행
  - mysql -u root -p < employees.sql 입력
  - ![6-14](./image/6-14.PNG)
  - 확인
    - ![6-15](/image/6-15.PNG)



#### 5) Rtools35 다운 (sql을 R로 불러오기 위한 파일)

- 아래 사진처럼 체크박스만 모두 체크하고 나머지는 기본 설정
  - ![6-16](./image/6-16.PNG)



#### 6) libmysql.lib 복사

- RMySQL 컴파일 시 libmysql.lib 파일을 찾는 위치는 MySQL 설치 시의 기본 파일 위치와 다르다.
  - 이를 해결하기 위해 파일 C:\Program Files\MySQL\MySQL Server 5.6\lib\libmysql.lib를 C:\Program Files\MySQL\MySQL Server 5.6\lib\opt\libmysql.lib에 복사한다. 
  - opt 디렉터리는 존재하지 않으므로 직접 만들고 파일을 복사해 넣으면 된다.
  - opt라는 폴더를 만들고 그냥 복붙 끝!



#### 7) RStuio에서 설정 및 사용해보기

- ```R
  install.packages("RMySQL", type = "source")
  library(RMySQL)
  ```

- database에 연결하는 구문은 아래와 같다.

  - ```R
    RMySQL::dbConnect(
      drv,      # 데이터베이스 드라이버(RPgSQL, ROracle, MySQL 등)
      user,     # 사용자 이름
      password, # 비밀번호
      dbname,   # 데이터베이스 이름
      host      # 호스트
    )
    
    RMySQL::dbListTables(
      conn # 데이터베이스 접속
    )
    
    RMySQL::dbGetQuery(
      conn, # 데이터베이스 접속
      statement # 수행할 질의
    )
    ```

  - ```R
    install.packages("RMySQL", type = "source")
    library(RMySQL)
    
    con <- dbConnect(MySQL(), user = "user1", password="1234", dbname="employees", host="70.12.115.72")
    > dbListTables(con)
    [1] "current_dept_emp"     "departments"          "dept_emp"             "dept_emp_latest_date"
    [5] "dept_manager"         "employees"            "salaries"             "titles"     
    
    > dbGetQuery(con, "select * from salaries")
            emp_no salary  from_date    to_date
    1        10001  60117 1986-06-26 1987-06-26
    2        10001  62102 1987-06-26 1988-06-25
    3        10001  66074 1988-06-25 1989-06-25
    4        10001  66596 1989-06-25 1990-06-25
    5        10001  66961 1990-06-25 1991-06-25
    ```

  - 자기 자신을 접속할 때에는 localhost, 127.0.0.1 둘 중 하나를 사용한다.

    - 

    ```R
    # 자기 자신을 접속할 때에는 localhost, 127.0.0.1 둘 중 하나를 사용
    
    con2 <- dbConnect(MySQL(), user = "root", password="1234", dbname="employees", host="127.0.0.1")
    > dbListTables(con2)
    [1] "current_dept_emp"     "departments"          "dept_emp"             "dept_emp_latest_date"
    [5] "dept_manager"         "employees"            "salaries"             "titles"  
    
    > dbGetQuery(con2, "Select * from salaries")
            emp_no salary  from_date    to_date
    1        10001  60117 1986-06-26 1987-06-26
    2        10001  62102 1987-06-26 1988-06-25
    3        10001  66074 1988-06-25 1989-06-25
    4        10001  66596 1989-06-25 1990-06-25
    5        10001  66961 1990-06-25 1991-06-25
    
    ```

- data.frame으로 당연히 치환가능하다. (기본형이 data.frame이다.)

  - ```R
    > df <- dbGetQuery(con2, "Select * from salaries")
    > class(df)
    [1] "data.frame"
    > str(df)
    'data.frame':	2844047 obs. of  4 variables:
     $ emp_no   : int  10001 10001 10001 10001 10001 10001 10001 10001 10001 10001 ...
     $ salary   : int  60117 62102 66074 66596 66961 71046 74333 75286 75994 76884 ...
     $ from_date: chr  "1986-06-26" "1987-06-26" "1988-06-25" "1989-06-25" ...
     $ to_date  : chr  "1987-06-26" "1988-06-25" "1989-06-25" "1990-06-25" ...
    ```

- data.table으로 치환가능하다.

  - ```R
    > library(data.table)
    > df <- dbGetQuery(con2, "Select * from employees")
    > df2 <- data.table(df)
    > class(df2)
    [1] "data.table" "data.frame"
    > df2[emp_no > 10003,,]
            emp_no birth_date first_name last_name gender  hire_date
         1:  10004 1954-05-01  Chirstian   Koblick      M 1986-12-01
         2:  10005 1955-01-21    Kyoichi  Maliniak      M 1989-09-12
         3:  10006 1953-04-20     Anneke   Preusig      F 1989-06-02
         4:  10007 1957-05-23    Tzvetan Zielinski      F 1989-02-10
         5:  10008 1958-02-19     Saniya  Kalloufi      M 1994-09-15
        ---                                                         
    300017: 499995 1958-09-24     Dekang  Lichtner      F 1993-01-12
    300018: 499996 1953-03-07       Zito      Baaz      M 1990-09-27
    300019: 499997 1961-08-03    Berhard    Lenart      M 1986-04-21
    300020: 499998 1956-09-05   Patricia   Breugel      M 1993-10-13
    300021: 499999 1958-05-01     Sachin   Tsukuda      M 1997-11-30
    ```

  - 